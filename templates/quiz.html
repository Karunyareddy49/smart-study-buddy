<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ subject }} Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- MathJax -->
    <script>
    window.MathJax = {
        tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <style>
    .correct { color: green; font-weight: bold; }
    .wrong { color: red; font-weight: bold; }
    .feedback { margin-top: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1>{{ subject }} Quiz</h1>
    <form id="quizForm">
        {% for q in mcqs %}
            {% set q_index = loop.index0 %}
            <div class="question-block" id="question-{{ q_index }}">
                <p><strong>Question {{ loop.index }}:</strong> {{ q.question | safe }}</p>
                {% for option in q.options %}
                    <label>
                        <input type="radio" name="q{{ q_index }}" value="{{ option | safe }}">
                        {{ option | safe }}
                    </label><br>
                {% endfor %}
                <!-- store correct answer in data attribute -->
                <div class="feedback" id="feedback-{{ q_index }}" data-answer="{{ q.answer | safe }}"></div>
            </div>
            <hr>
        {% endfor %}
        <button type="button" onclick="checkAnswers()">Submit Quiz</button>
    </form>
    <p id="score"></p>
    <a href="{{ url_for('home') }}">Back to Home</a>
</div>

<script>
function checkAnswers() {
    let score = 0;
    const questionBlocks = document.querySelectorAll('.question-block');

    questionBlocks.forEach((block, i) => {
        const radios = Array.from(block.querySelectorAll('input[type="radio"]'));
        const selected = radios.find(r => r.checked);
        const feedbackDiv = block.querySelector('.feedback');
        const correctAnswer = feedbackDiv.getAttribute('data-answer');

        feedbackDiv.innerHTML = '';

        if (!selected) {
            feedbackDiv.innerHTML = '<span class="wrong">No answer selected. Correct: ' + correctAnswer + '</span>';
            return;
        }

        if (selected.value === correctAnswer) {
            feedbackDiv.innerHTML = '<span class="correct">Correct!</span>';
            score += 1;
        } else {
            feedbackDiv.innerHTML = '<span class="wrong">Wrong! Correct answer: ' + correctAnswer + '</span>';
        }
    });

    document.getElementById('score').innerHTML = 'Your Score: ' + score + ' / ' + questionBlocks.length;

    // Re-render MathJax for any new content
    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
    }
}
</script>
</body>
</html>
